import csv
import random
from datetime import datetime, timedelta

equipment_types = [
    ("MRI Scanner", "MRI"),
    ("Ultrasound", "US"),
    ("CT Scanner", "CT"),
    ("X-Ray Machine", "XRAY"),
    ("Mammography Unit", "MAMMO")
]

departments = {
    "MRI Scanner": "Radiology",
    "Ultrasound": "Radiology",
    "CT Scanner": "Radiology",
    "X-Ray Machine": "Radiology",
    "Mammography Unit": "Women's Health"
}

def random_date(start, end):
    """Generate a random date between two dates."""
    delta = end - start
    random_days = random.randint(0, delta.days)
    return start + timedelta(days=random_days)

def mode_of_payment():
    return "insurance" if random.random() < 0.7 else "cash"

def generate_row(row_num):
    # Date
    date_obj = random_date(datetime(2023, 1, 1), datetime(2023, 12, 31))
    date = date_obj.strftime("%Y-%m-%d")
    day_of_week = date_obj.strftime("%A")
    month = date_obj.strftime("%B")
    is_weekend = str(day_of_week in ["Saturday", "Sunday"])
    
    # Equipment
    eq_type, eq_code = random.choice(equipment_types)
    equip_id = f"{eq_code}_{row_num:04d}"
    dept = departments[eq_type]
    
    # Hours
    if eq_type == "MRI Scanner":
        avail_hours = random.randint(8, 16)
        actual_hours = round(random.uniform(0.5, 4), 1)
    elif eq_type == "Ultrasound":
        avail_hours = random.randint(8, 12)
        actual_hours = round(random.uniform(6, avail_hours), 1)
    else:
        avail_hours = random.randint(8, 20)
        actual_hours = round(random.uniform(3, avail_hours), 1)
    utilization_rate = round(actual_hours / avail_hours, 2)
    
    # Procedures
    if eq_type == "MRI Scanner":
        procedures = random.randint(1, 5)
    elif eq_type == "Ultrasound":
        procedures = random.randint(15, 40)
    else:
        procedures = random.randint(6, 30)
    
    # Costs
    daily_cost = round(random.uniform(500, 7500), 2)
    maintenance_cost = 0  # As requested
    procedure_revenue = round(random.uniform(1200, 50000), 2)
    
    # Payment
    payment = mode_of_payment()
    
    return [
        date, equip_id, eq_type, dept, avail_hours, actual_hours, utilization_rate,
        procedures, daily_cost, maintenance_cost, procedure_revenue,
        day_of_week, month, is_weekend, payment
    ]

with open("medical_equipment_utilization_synthetic.csv", "w", newline='') as f:
    writer = csv.writer(f)
    writer.writerow([
        "Date", "Equipment_ID", "Equipment_Type", "Department", "Available_Hours", "Actual_Operating_Hours",
        "Utilization_Rate", "Number_of_Procedures", "Daily_Operating_Cost", "Maintenance_Cost",
        "Procedure_Revenue", "Day_of_Week", "Month", "Is_Weekend", "Mode_of_Payment"
    ])
    for i in range(1, 3001):
        writer.writerow(generate_row(i))

print("File generated: medical_equipment_utilization_synthetic.csv")
